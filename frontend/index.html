<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CAMPS PDF Manager v2.0</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
      <div class="spinner"></div>
      <p>Carregando CAMPS PDF Manager...</p>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal" style="display: none">
      <div class="modal-content login-modal">
        <div class="login-header">
          <h1>üè¢ CAMPS PDF Manager</h1>
          <p>Sistema de Gerenciamento de Documentos</p>
        </div>
        <form id="loginForm">
          <div class="form-group">
            <label for="loginEmail">Email:</label>
            <input
              type="email"
              id="loginEmail"
              required
              placeholder="admin@camps.com"
            />
          </div>
          <div class="form-group">
            <label for="loginPassword">Senha:</label>
            <input
              type="password"
              id="loginPassword"
              required
              placeholder="admin123"
            />
          </div>
          <div id="loginError" class="error-message"></div>
          <button type="submit" class="btn-primary btn-block">Entrar</button>
        </form>
        <div class="login-footer">
          <small>Credenciais padr√£o: admin@camps.com | admin123</small>
        </div>
      </div>
    </div>

    <!-- Main Application Container -->
    <div id="appContainer" style="display: none">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-logo">
            <img
              src="assets/camps-logo.png"
              alt="CAMPS Logo"
              class="company-logo"
            />
          </div>
          <h2>CAMPS</h2>
          <p>PDF Metadata Manager</p>
        </div>

        <nav class="sidebar-nav">
          <button class="nav-btn active" data-section="dashboard">
            üìä Dashboard
          </button>
          <button class="nav-btn" data-section="documents">
            üìÑ Documentos
          </button>
          <button class="nav-btn" data-section="upload">üì§ Upload</button>
          <button
            class="nav-btn"
            id="usersNav"
            data-section="users"
            style="display: none"
          >
            üë• Usu√°rios
          </button>
        </nav>

        <div class="sidebar-footer">
          <div id="userInfo" class="user-info"></div>
          <button id="logoutBtn" class="btn-secondary btn-block">
            üö™ Sair
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboardSection" class="content-section active">
          <header class="section-header">
            <h1>üìä Dashboard</h1>
          </header>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üìÑ</div>
              <div class="stat-info">
                <h3 id="totalDocs">0</h3>
                <p>Total de Documentos</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚úì</div>
              <div class="stat-info">
                <h3 id="signedDocs">0</h3>
                <p>Documentos Assinados</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìÖ</div>
              <div class="stat-info">
                <h3 id="todayDocs">0</h3>
                <p>Uploads Hoje</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìà</div>
              <div class="stat-info">
                <h3 id="signingRate">0%</h3>
                <p>Taxa de Assinatura</p>
              </div>
            </div>
          </div>

          <div class="charts-grid">
            <!-- Timeline Chart -->
            <div class="chart-card">
              <h3>üìà Documentos por Dia</h3>
              <canvas id="timelineChart"></canvas>
            </div>

            <!-- Type Chart -->
            <div class="chart-card">
              <h3>üìä Documentos por Tipo</h3>
              <canvas id="typeChart"></canvas>
            </div>

            <!-- Signature Chart -->
            <div class="chart-card">
              <h3>‚úì Status de Assinaturas</h3>
              <canvas id="signatureChart"></canvas>
            </div>
          </div>

          <div class="recent-section">
            <h3>üìã Documentos Recentes</h3>
            <div id="recentDocuments" class="recent-documents"></div>
          </div>
        </section>

        <!-- Documents Section -->
        <section id="documentsSection" class="content-section">
          <header class="section-header">
            <h1>üìÑ Gerenciar Documentos</h1>
            <div class="header-actions">
              <input
                type="text"
                id="searchInput"
                placeholder="Buscar documentos..."
                onkeyup="if(event.key==='Enter') loadDocuments(1)"
              />
              <select id="typeFilter" onchange="loadDocuments(1)">
                <option value="">Todos os tipos</option>
                <option value="contrato">Contrato</option>
                <option value="ata">Ata</option>
                <option value="relatorio">Relat√≥rio</option>
                <option value="nota_fiscal">Nota Fiscal</option>
                <option value="prontuario">Prontu√°rio</option>
              </select>
              <select id="categoryFilter" onchange="loadDocuments(1)">
                <option value="">Todas as categorias</option>
                <option value="Administrativo">Administrativo</option>
                <option value="Financeiro">Financeiro</option>
                <option value="Jur√≠dico">Jur√≠dico</option>
                <option value="Recursos Humanos">RH</option>
                <option value="T√©cnico">T√©cnico</option>
                <option value="Trabalhista">Trabalhista</option>
                <option value="M√©dico">M√©dico</option>
              </select>
              <button class="btn-primary" onclick="loadDocuments(1)">
                üîç Buscar
              </button>
            </div>
          </header>

          <!-- Batch Actions Bar -->
          <div
            id="batchActionsBar"
            class="batch-actions-bar"
            style="display: none"
          >
            <span class="batch-info">
              <strong
                ><span id="selectedCount">0</span> documentos
                selecionados</strong
              >
            </span>
            <div class="batch-buttons">
              <button class="btn-primary" id="batchMetadataBtn">
                üìù Adicionar Metadados
              </button>
              <button class="btn-danger" id="batchDeleteBtn">
                üóëÔ∏è Deletar Selecionados
              </button>
              <button class="btn-secondary" onclick="clearSelection()">
                ‚úñ Cancelar
              </button>
            </div>
          </div>

          <!-- Documents Table -->
          <div class="table-container">
            <table class="documents-table">
              <thead>
                <tr>
                  <th width="40">
                    <input
                      type="checkbox"
                      id="selectAllCheckbox"
                      onclick="toggleSelectAll()"
                    />
                  </th>
                  <th width="60" class="sortable" onclick="sortDocuments('id')">
                    ID <span class="sort-icon">‚Üï</span>
                  </th>
                  <th class="sortable" onclick="sortDocuments('title')">
                    T√≠tulo / Arquivo <span class="sort-icon">‚Üï</span>
                  </th>
                  <th>Autor</th>
                  <th>Tipo</th>
                  <th>Categoria</th>
                  <th width="100">Tamanho</th>
                  <th width="120" class="sortable" onclick="sortDocuments('is_signed')">
                    Status <span class="sort-icon">‚Üï</span>
                  </th>
                  <th width="150" class="sortable" onclick="sortDocuments('uploaded_at')">
                    Data Upload <span class="sort-icon">‚Üï</span>
                  </th>
                  <th width="150">A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="documentsTableBody">
                <tr>
                  <td colspan="9" class="loading-state">
                    <div class="spinner"></div>
                    Carregando documentos...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div id="pagination" class="pagination"></div>
        </section>

        <!-- Upload Section -->
        <section id="uploadSection" class="content-section">
          <header class="section-header">
            <h1>üì§ Upload de PDFs</h1>
          </header>

          <div class="upload-container">
            <div id="dropZone" class="drop-zone">
              <div class="drop-zone-icon">üìÅ</div>
              <h3>Arraste e solte PDFs aqui</h3>
              <p>ou clique para selecionar arquivos</p>
              <input type="file" id="fileInput" multiple accept=".pdf" hidden />
              <button
                class="btn-secondary"
                onclick="document.getElementById('fileInput').click()"
              >
                Selecionar Arquivos
              </button>
              <p class="upload-info">M√°ximo: 50MB por arquivo</p>
            </div>

            <div id="fileList" class="file-list">
              <p class="empty-state">Nenhum arquivo selecionado</p>
            </div>

            <!-- ‚úÖ FASE 1: Formul√°rio de Metadados Obrigat√≥rios -->
            <div id="metadataForm" class="metadata-form" style="display: none;">
              <h3>üìã Metadados FASE 1 - Decreto 10.278/2020</h3>
              <p class="form-description">
                Campos obrigat√≥rios para conformidade legal na digitaliza√ß√£o de documentos.
              </p>

              <div class="form-grid">
                <!-- Digitalizador -->
                <div class="form-group">
                  <label for="digitizer_name">üë§ Nome do Digitalizador *</label>
                  <input
                    type="text"
                    id="digitizer_name"
                    required
                    placeholder="Ex: Jo√£o Silva"
                    maxlength="200"
                  />
                </div>

                <div class="form-group">
                  <label for="digitizer_cpf_cnpj">üÜî CPF/CNPJ do Digitalizador *</label>
                  <input
                    type="text"
                    id="digitizer_cpf_cnpj"
                    required
                    placeholder="000.000.000-00 ou 00.000.000/0001-00"
                    maxlength="18"
                  />
                  <small>Apenas n√∫meros (ser√° formatado automaticamente)</small>
                </div>

                <!-- Digitaliza√ß√£o -->
                <div class="form-group">
                  <label for="resolution_dpi">üìê Resolu√ß√£o (DPI) *</label>
                  <input
                    type="number"
                    id="resolution_dpi"
                    required
                    value="300"
                    min="150"
                    max="1200"
                  />
                  <small>M√≠nimo: 150 DPI (recomendado: 300 DPI)</small>
                </div>



                <!-- Organiza√ß√£o -->
                <div class="form-group">
                  <label for="company_name">üè¢ Nome da Empresa</label>
                  <input
                    type="text"
                    id="company_name"
                    value="CAMPS Santos"
                    maxlength="200"
                  />
                </div>

                <div class="form-group">
                  <label for="company_cnpj">üèõÔ∏è CNPJ da Empresa</label>
                  <input
                    type="text"
                    id="company_cnpj"
                    placeholder="00.000.000/0001-00"
                    maxlength="18"
                  />
                </div>

                <!-- Classifica√ß√£o -->
                <div class="form-group">
                  <label for="document_type">üìÇ Tipo de Documento</label>
                  <input
                    type="text"
                    id="document_type"
                    placeholder="Ex: Contrato de Aprendizagem"
                    maxlength="100"
                  />
                </div>

                <div class="form-group">
                  <label for="document_category">üìë Categoria</label>
                  <select id="document_category">
                    <option value="">Selecione...</option>
                    <option value="Administrativo">Administrativo</option>
                    <option value="Financeiro">Financeiro</option>
                    <option value="Jur√≠dico">Jur√≠dico</option>
                    <option value="Recursos Humanos">Recursos Humanos</option>
                    <option value="T√©cnico">T√©cnico</option>
                    <option value="Trabalhista">Trabalhista</option>
                    <option value="M√©dico">M√©dico</option>
                  </select>
                </div>
              </div>

              <div class="form-note">
                <strong>* Campos obrigat√≥rios</strong> conforme Decreto 10.278/2020
              </div>
            </div>

            <div class="upload-actions">
              <button id="uploadBtn" class="btn-primary btn-lg" disabled>
                üì§ Enviar PDFs
              </button>
              <button id="clearBtn" class="btn-secondary">
                üóëÔ∏è Limpar Lista
              </button>
            </div>

            <div
              id="uploadResults"
              class="upload-results"
              style="display: none"
            ></div>
          </div>
        </section>

        <!-- Users Section (Admin Only) -->
        <section id="usersSection" class="content-section">
          <header class="section-header">
            <h1>üë• Gerenciar Usu√°rios</h1>
            <button class="btn-primary" onclick="openCreateUserModal()">
              ‚ûï Novo Usu√°rio
            </button>
          </header>

          <div class="table-container">
            <table class="documents-table">
              <thead>
                <tr>
                  <th width="60">ID</th>
                  <th>Nome</th>
                  <th>Email</th>
                  <th width="120">Role</th>
                  <th width="100">Status</th>
                  <th width="120">A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <tr>
                  <td colspan="6" class="loading-state">
                    <div class="spinner"></div>
                    Carregando usu√°rios...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
      </main>
    </div>

    <!-- ========== MODAL: Batch Metadata ========== -->
    <div id="batchMetadataModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üìù Adicionar Metadados em Lote</h2>
          <button class="modal-close" onclick="closeBatchModal()">‚úñ</button>
        </div>

        <p class="modal-info">
          <strong
            ><span id="batchDocCount">0</span> documentos selecionados</strong
          >
        </p>

        <form id="batchMetadataForm">
          <div class="form-group">
            <label for="batchAuthor">Autor:</label>
            <input
              type="text"
              id="batchAuthor"
              maxlength="255"
              placeholder="Ex: Dr. Jo√£o Silva"
            />
          </div>

          <div class="form-group">
            <label for="batchSubject">Assunto:</label>
            <input
              type="text"
              id="batchSubject"
              maxlength="500"
              placeholder="Ex: Contratos de Presta√ß√£o de Servi√ßos 2025"
            />
          </div>

          <!-- FASE 1: Novos Campos de Lote -->
          <div class="form-grid">
              <div class="form-group">
                <label for="batchDigitizerName">Digitalizador:</label>
                <input
                  type="text"
                  id="batchDigitizerName"
                  maxlength="200"
                  placeholder="Nome do respons√°vel"
                />
              </div>

              <div class="form-group">
                <label for="batchDigitizerCpfCnpj">CPF/CNPJ:</label>
                <input
                  type="text"
                  id="batchDigitizerCpfCnpj"
                  maxlength="18"
                  placeholder="000.000.000-00"
                />
              </div>

              <div class="form-group">
                <label for="batchResolution">Resolu√ß√£o (DPI):</label>
                <input
                  type="number"
                  id="batchResolution"
                  min="150"
                  max="1200"
                  placeholder="300"
                />
              </div>

              <div class="form-group">
                <label for="batchCompanyName">Empresa:</label>
                <input
                  type="text"
                  id="batchCompanyName"
                  maxlength="200"
                  value="CAMPS Santos"
                />
              </div>
          </div>

          <div class="form-group">
            <label for="batchDocType">Tipo de Documento:</label>
            <select id="batchDocType">
              <option value="">Selecione...</option>
              <option value="contrato">Contrato</option>
              <option value="ata">Ata de Reuni√£o</option>
              <option value="relatorio">Relat√≥rio</option>
              <option value="nota_fiscal">Nota Fiscal</option>
              <option value="estatuto">Estatuto</option>
              <option value="regimento">Regimento Interno</option>
              <option value="convenio">Conv√™nio</option>
              <option value="prontuario">Prontu√°rio</option>
              <option value="receita">Receita M√©dica</option>
              <option value="atestado">Atestado</option>
              <option value="exame">Exame</option>
              <option value="laudo">Laudo</option>
            </select>
          </div>

          <div class="form-group">
            <label for="batchDocCategory">Categoria:</label>
            <select id="batchDocCategory">
              <option value="">Selecione...</option>
              <option value="Administrativo">Administrativo</option>
              <option value="Financeiro">Financeiro</option>
              <option value="Jur√≠dico">Jur√≠dico</option>
              <option value="Recursos Humanos">Recursos Humanos</option>
              <option value="T√©cnico">T√©cnico</option>
              <option value="Trabalhista">Trabalhista</option>
              <option value="M√©dico">M√©dico</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary btn-lg">
              ‚ö° Processar em Lote
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="closeBatchModal()"
            >
              Cancelar
            </button>
          </div>
        </form>

        <!-- Progress Bar -->
        <div id="batchProgress" class="batch-progress" style="display: none">
          <div class="progress-bar-container">
            <div
              id="batchProgressBar"
              class="progress-bar-fill"
              style="width: 0%"
            ></div>
          </div>
          <p id="batchProgressText" class="progress-text">Processando...</p>
        </div>

        <!-- Results -->
        <div
          id="batchResults"
          class="batch-results"
          style="display: none"
        ></div>
      </div>
    </div>

    <!-- ========== MODAL: Document Details ========== -->
    <div id="documentModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üìÑ <span id="viewDocTitle">Detalhes do Documento</span></h2>
          <button class="modal-close" onclick="closeDocumentModal()">‚úñ</button>
        </div>
        <div class="modal-body">
            <div id="docDetailsContent" class="doc-details-grid"></div>
            <hr class="modal-divider">
            <div id="docFase1Content" class="doc-fase1-grid"></div>
        </div>
      </div>
    </div>

    <!-- Scripts -->


    <script>
      // Helper functions are now in main.js
    </script>

    <!-- ========================================
     MODAL: CRIAR USU√ÅRIO
     ======================================== -->
    <div id="createUserModal" class="modal">
      <div class="modal-content modal-sm">
        <div class="modal-header">
          <h3>‚ûï Criar Novo Usu√°rio</h3>
          <button class="close-btn" onclick="closeCreateUserModal()">
            &times;
          </button>
        </div>

        <form id="createUserForm" onsubmit="createUser(event)">
          <div class="modal-body">
            <div class="form-group">
              <label for="newUserName">Nome Completo *</label>
              <input
                type="text"
                id="newUserName"
                name="name"
                class="form-control"
                placeholder="Ex: Jo√£o Silva"
                required
              />
            </div>

            <div class="form-group">
              <label for="newUserEmail">Email *</label>
              <input
                type="email"
                id="newUserEmail"
                name="email"
                class="form-control"
                placeholder="Ex: joao@camps.com"
                required
              />
            </div>

            <div class="form-group">
              <label for="newUserPassword">Senha *</label>
              <input
                type="password"
                id="newUserPassword"
                name="password"
                class="form-control"
                placeholder="M√≠nimo 6 caracteres"
                minlength="6"
                required
              />
            </div>

            <div class="form-group">
              <label for="newUserRole">N√≠vel de Acesso</label>
              <select id="newUserRole" name="role" class="form-control">
                <option value="viewer">Viewer - Apenas visualiza√ß√£o</option>
                <option value="user" selected>
                  User - Envio e visualiza√ß√£o
                </option>
                <option value="admin">Admin - Acesso completo</option>
              </select>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  id="newUserActive"
                  name="is_active"
                  checked
                />
                <span>Usu√°rio ativo</span>
              </label>
            </div>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeCreateUserModal()"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              ‚ûï Criar Usu√°rio
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- ========================================
     MODAL: EDITAR USU√ÅRIO
     ======================================== -->
    <div id="editUserModal" class="modal">
      <div class="modal-content modal-sm">
        <div class="modal-header">
          <h3>‚úèÔ∏è Editar Usu√°rio</h3>
          <button class="close-btn" onclick="closeEditUserModal()">
            &times;
          </button>
        </div>

        <form id="editUserForm" onsubmit="updateUser(event)">
          <input type="hidden" id="editUserId" name="id" />

          <div class="modal-body">
            <div class="form-group">
              <label for="editUserName">Nome Completo *</label>
              <input
                type="text"
                id="editUserName"
                name="name"
                class="form-control"
                required
              />
            </div>

            <div class="form-group">
              <label for="editUserEmail">Email *</label>
              <input
                type="email"
                id="editUserEmail"
                name="email"
                class="form-control"
                required
              />
            </div>

            <div class="form-group">
              <label for="editUserPassword"
                >Nova Senha (deixe em branco para manter)</label
              >
              <input
                type="password"
                id="editUserPassword"
                name="password"
                class="form-control"
                placeholder="Preencha apenas se quiser alterar"
                minlength="6"
              />
            </div>

            <div class="form-group">
              <label for="editUserRole">N√≠vel de Acesso</label>
              <select id="editUserRole" name="role" class="form-control">
                <option value="viewer">Viewer - Apenas visualiza√ß√£o</option>
                <option value="user">User - Envio e visualiza√ß√£o</option>
                <option value="admin">Admin - Acesso completo</option>
              </select>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="editUserActive" name="is_active" />
                <span>Usu√°rio ativo</span>
              </label>
            </div>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeEditUserModal()"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              üíæ Salvar Altera√ß√µes
            </button>
          </div>
        </form>
      </div>
    </div>
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Modular Architecture -->
    <script type="module" src="js/main.js"></script>
    
    <!-- Fallback -->
    <script nomodule>
        alert('Seu navegador n√£o suporta m√≥dulos ES6.');
    </script>
  </body>
</html>
